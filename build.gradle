/* 
 * ğŸ—ï¸ [Root build.gradle]
 * PayLab ì „ì²´ í”„ë¡œì íŠ¸ì˜ ë£¨íŠ¸ ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸
 * - ëª¨ë“  ëª¨ë“ˆ(api, core, common)ì— ê³µí†µ ì„¤ì • ì ìš©
 * - ë²„ì „/ë¦¬í¬ì§€í† ë¦¬ ê´€ë¦¬
 * - ê³µí†µ dependency ê´€ë¦¬(Lombok, Test ë“±)
 * - ê°œë³„ ëª¨ë“ˆì—ì„œëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ë³„ ë¼ì´ë¸ŒëŸ¬ë¦¬ë§Œ ì„ ì–¸
 */

plugins {
	// Spring Boot ì˜ì¡´ì„± ê´€ë¦¬ìš© í”ŒëŸ¬ê·¸ì¸ (Boot BOM, ë²„ì „ ì¼ê´€ì„± ì œê³µ)
	id 'io.spring.dependency-management' version '1.1.4'

	// Spring Boot í”ŒëŸ¬ê·¸ì¸ (ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰/íŒ¨í‚¤ì§•ìš©)
	// => ë£¨íŠ¸ì—ì„œëŠ” apply false (í•˜ìœ„ ëª¨ë“ˆì—ì„œë§Œ ì ìš©)
	id 'org.springframework.boot' version '3.3.2' apply false
}

/*
 * ğŸ§© [allprojects ë¸”ë¡]
 * - ë£¨íŠ¸ í¬í•¨ ëª¨ë“  í•˜ìœ„ í”„ë¡œì íŠ¸ ê³µí†µ ì„¤ì •
 * - group / version / repositories ë“±ì˜ ê³µí†µ ì†ì„± ì§€ì •
 */
allprojects {
	group = 'dev.dyko.paylab'       // íŒ¨í‚¤ì§€ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ (ex. dev.dyko.paylab.core)
	version = '1.0.0'      			// ì „ì²´ ë²„ì „ (ê³µí†µ)

	repositories {
		mavenCentral() 				// ì˜ì¡´ì„± ë‹¤ìš´ë¡œë“œ ìœ„ì¹˜ (ê¸°ë³¸ Maven ì¤‘ì•™ ì €ì¥ì†Œ)
	}
}

/*
 * ğŸ§± [subprojects ë¸”ë¡]
 * - ë£¨íŠ¸ë¥¼ ì œì™¸í•œ í•˜ìœ„ ëª¨ë“ˆ(paylab-api, paylab-core, paylab-common)ì—ë§Œ ì ìš©ë¨
 * - ì½”ë“œ ë ˆë²¨ ê³µí†µ ì„¤ì • (Lombok, JUnit ë“±)
 */
subprojects {
	// ê° ëª¨ë“ˆì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë™ì‘í•˜ë„ë¡ ì§€ì • (apiëŠ” boot plugin ë”°ë¡œ ì ìš©)
	apply plugin: 'io.spring.dependency-management'

	plugins.withType(JavaPlugin) {
		java {
			toolchain { languageVersion = JavaLanguageVersion.of(21) }
		}

		// í•˜ìœ„ ëª¨ë“ˆì—ì„œ Java pluginì´ ëª…ì‹œì ìœ¼ë¡œ ì ìš©ëœ ê²½ìš°ë§Œ ì ìš©ë¨
		dependencies {
			compileOnly 'org.projectlombok:lombok'
			annotationProcessor 'org.projectlombok:lombok'
			testCompileOnly 'org.projectlombok:lombok'
			testAnnotationProcessor 'org.projectlombok:lombok'
			testImplementation 'org.springframework.boot:spring-boot-starter-test'
		}

		tasks.withType(JavaCompile) { options.encoding = 'UTF-8' }
		tasks.withType(Test) { useJUnitPlatform() }

		// ğŸ”¹ ë©€í‹°ëª¨ë“ˆ bootJar ì„¤ì •
		def bootModules = ['paylab-api']  // ì‹¤í–‰ ê°€ëŠ¥í•œ ëª¨ë“ˆë§Œ ì§€ì •
		tasks.withType(org.springframework.boot.gradle.tasks.bundling.BootJar).configureEach {
			if (project.name in bootModules) {
				// ì‹¤í–‰ ëª¨ë“ˆì´ë©´ mainClass ì§€ì •
				mainClass.set('dev.dyko.paylab.PayLabApiApplication')
			} else {
				// ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª¨ë“ˆì´ë©´ bootJar ë¹„í™œì„±í™”
				enabled = false
			}
		}

		// ğŸ”¹ ëª¨ë“  ëª¨ë“ˆì—ì„œ ì¼ë°˜ Jar í™œì„±í™”
		tasks.named('jar') { enabled = true }
	}
}